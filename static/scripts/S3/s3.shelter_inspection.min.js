(function($,undefined){"use strict";var shelterInspectionID=0;$.widget('s3.shelterInspection',{options:{ajaxURL:''},_create:function(){var el=$(this.element);this.id=shelterInspectionID;shelterInspectionID+=1;this.eventNamespace='.shelterInspection';},_init:function(){var el=$(this.element);this.refresh();},_destroy:function(){$.Widget.prototype.destroy.call(this);},refresh:function(){var opts=this.options;this._unbindEvents();this._toggleSubmit(false);this._bindEvents();},_registerInspection:function(){var opts=this.options,ajaxURL=opts.ajaxURL;this._clearAlert();var throbber=$('<div class="inline-throbber">').insertBefore('#submit_record__row');var input={u:$('#shelter_inspection_shelter_unit_id').val(),f:$('#shelter_flags-options').val(),c:$('#shelter_inspection_comments').val()};var self=this;$.ajaxS3({'url':ajaxURL,'type':'POST','dataType':'json','contentType':'application/json; charset=utf-8','data':JSON.stringify(input),'success':function(data){throbber.remove();if(data.e){}else{self._clearForm();}
if(data.a){S3.showAlert(data.a,'error',false);}else if(data.m){S3.showAlert(data.m,'success',false);}},'error':function(){throbber.remove();this._clearForm(true);}});},_toggleSubmit:function(submit){if(submit){$('.submit-btn').removeClass('disabled').prop('disabled',false);}else{$('.submit-btn').addClass('disabled').prop('disabled',true);}},_clearAlert:function(){$('.alert-error, .alert-warning, .alert-info, .alert-success').fadeOut('fast');$('.error_wrapper').fadeOut('fast').remove();},_clearForm:function(keepAlert){$('.inline-throbber').remove();if(!keepAlert){this._clearAlert();}
var unitSelector=$('#shelter_inspection_shelter_unit_id');unitSelector.val('');if(unitSelector.hasClass('multiselect-widget')){unitSelector.multiselect('refresh');}
var flags=$('#shelter_flags-options');flags.val('');if(flags.hasClass('groupedopts-widget')){flags.groupedopts('refresh');}
$('#shelter_inspection_comments').val('');this._toggleSubmit(false);},_bindEvents:function(){var form=$(this.element),ns=this.eventNamespace,self=this;$('#shelter_inspection_shelter_unit_id').bind('change'+ns,function(){if($(this).val()){self._toggleSubmit(true);}else{self._toggleSubmit(false);}});form.find('.submit-btn').bind('click'+ns,function(e){e.preventDefault();self._registerInspection();});form.find('a.cancel-action').bind('click'+ns,function(e){e.preventDefault();self._clearForm();});return true;},_unbindEvents:function(){var form=$(this.element),ns=this.eventNamespace;$('#shelter_inspection_shelter_unit_id').unbind(ns);form.find('.submit-btn').unbind(ns);form.find('a.cancel-action').unbind(ns);return true;}});})(jQuery);