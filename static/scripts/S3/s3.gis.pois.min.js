(function(){var jsLoaded=function(map_id){var dfd=new jQuery.Deferred();var gis=S3.gis;setTimeout(function working(){if((gis.maps!=undefined)&&(gis.maps[map_id]!=undefined)){dfd.resolve('loaded');}else if(dfd.state()==='pending'){dfd.notify('waiting for JS to load...');setTimeout(working,500);}else{}},1);return dfd.promise();};var pointPlaced=function(feature,resource){var gis=S3.gis;var proj4326=gis.proj4326;var current_projection=feature.layer.map.getProjectionObject();var geometry=feature.geometry;if(geometry.CLASS_NAME!='OpenLayers.Geometry.Point'){geometry.transform(current_projection,proj4326);var wkt=geometry.toString();var url=S3.Ap.concat('/'+resource['c']+'/'+resource['f']+'/create.popup?refresh_layer='+resource['i']+'&wkt='+wkt);geometry.transform(proj4326,current_projection);}else{var centerPoint=geometry.getBounds().getCenterLonLat();centerPoint.transform(current_projection,proj4326);var url=S3.Ap.concat('/'+resource['c']+'/'+resource['f']+'/create.popup?refresh_layer='+resource['i']+'&lat='+centerPoint.lat+'&lon='+centerPoint.lon);centerPoint.transform(proj4326,current_projection);}
gis.maps['default_map'].s3.westPanelContainer.collapse();gis.addPopup(feature,url,undefined,true);};$(document).ready(function(){var map_id='default_map';$.when(jsLoaded(map_id)).then(function(status){S3.gis.maps[map_id].s3.pointPlaced=pointPlaced;},function(status){s3_debug(status);},function(status){s3_debug(status);});});})(jQuery);